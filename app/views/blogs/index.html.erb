<div class="blog-header">
	<%= render "blogs/header",user: @user %>
</div>


<div class="blog-main">
	<div class="blog-side-left">
	</div>
	<div class="blog-center">
		<!-- サクセスメッセージ -->
		<% flash.each do |key, value| %>
		<%= content_tag(:div, value, class: "#{key}") %>
		<% end %>
		<h1>Blog一覧ページ</h1>

					<!-- ユーザーが投稿したブログ内容をeach文を回していく -->
				<% @blogs.each do |blog| %>
					<div class="blog-index-box">
						<%= link_to user_path(blog.user) do %>
						<%= attachment_image_tag blog.user, :profile_image, :fill, 100, 100 ,fallback: "unnamed.gif",size:'100x100',class:"img-photo" %>
						<% end %>
						<strong>Name:<%= link_to blog.user.name ,user_path(blog.user) %></strong><br>
						<!-- キャリアウエーブの使用上、「image_url」で画像が表示される -->
						<!-- 「if bi.image_url」は「bi.image_urlが」ある時だけ表示。エラーを防ぐため -->
						<div class="blog_slick">
							<% blog.images.each do |bi| %>
							<%= image_tag(bi.image_url, size:'300x200' ,class:"blog_slick-image") if bi.image_url %>
							<% end %><br>
						</div>

						<!-- ブログ内容 -->
						<strong class="blog-title"><%= blog.title %></strong><br>
						<div id="links_buttons_<%= blog.id %>">
							<% if user_signed_in? %>
							<%= render partial: "blogs/link", locals: {blog: blog} %>
							<% end %>
						</div>
						<%= blog.comments.count %>コメント<br>
						<%= link_to "ブログの記事を見る", blog_path(blog),data: {"turbolinks" => false}, class:"btn btn-primary" %><br>
							<!-- enumのキーを渡している -->
							Category:<%= link_to blog.category_i18n ,blogs_path(:category => blog.category)
							%>
						<div class="index-box-bottom">
						</div>
					</div>
				<% end %>

					<%= paginate @blogs, class: "paginate" %>

	</div>
	<div class="blog-side-right">
		<div class="category-box">
			<h3>カテゴリー</h3>
			<% @categories.each do |category| %>
			<h4><%= link_to category[0], blogs_path(:category => category[1]) %></h4><br>
			<% end %>
		</div>
	</div>
</div>


<!-- まっぷ -->
<h2>gmap</h2>

<!-- 地名入力用のinputを追加 -->
<input id="address" type="textbox" value="Sydney, NSW">

<!-- buttonをクリックしたらcodeAddressを実行　-->
<input type="button" value="Encode" onclick="codeAddress()">
<div id='map'>
</div>

<style>
#map{
  height: 400px;
}
</style>

<script>
/*
mapを関数の外で定義(codeAddressでも使うため)
geocoderを用意
*/

let map
let geocoder

function initMap(){
  // geocoderを初期化
  geocoder = new google.maps.Geocoder()

  map = new google.maps.Map(document.getElementById('map'), {
  center: {lat: -34.397, lng: 150.644},
  zoom: 8
  });
}

function codeAddress(){
  // 入力を取得
  let inputAddress = document.getElementById('address').value;

  // geocodingしたあとmapを移動
  geocoder.geocode( { 'address': inputAddress}, function(results, status) {
    if (status == 'OK') {
　　　　　　　　　　　　// map.setCenterで地図が移動
      map.setCenter(results[0].geometry.location);

　　　　　　　　　　　　// google.maps.MarkerでGoogleMap上の指定位置にマーカが立つ
      var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location
      });
    } else {
      alert('Geocode was not successful for the following reason: ' + status);
    }
  });
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script>




























